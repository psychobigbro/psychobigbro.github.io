<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>HK Race Control</title>
  <!--link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.css"/-->
  <link rel="stylesheet" href="themes/Bootstrap.css">
  <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />
  <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script>
  <link rel="stylesheet" type="text/css" href="inline.css">
</head>

<body>
  <div data-role="page" id="main-page" data-theme="a" data-url="main-page">
    <div data-role="header" data-theme="b" data-position="fixed">
      <h1 class="">HKRace 36</h1>
      <button id="routine-btn" data-icon="grid" data-iconpos="notext" data-shadow="false" data-iconshadow="false" class="ui-nodisc-icon">Routine</button>
      <!--a href="#" data-icon="refresh" data-iconpos="notext" data-shadow="false" data-iconshadow="false" class="ui-nodisc-icon">Refresh</a-->
      <button id="refresh-btn" data-icon="refresh" data-iconpos="notext" data-shadow="false" data-iconshadow="false" class="ui-nodisc-icon">Refresh</button>
    </div>
    <!-- /header -->
    <div data-role="content" id="content-container">
	  <!--form class="ui-filterable">
	    <label for="filterTable-input" class="ui-hidden-accessible">Filter:</label>
        <input type="search" id="filterTable-input" data-mini="true" placeholder="filter text ..." >
	  </form-->
      <table id="log-table" data-filter="true" data-input="#filterTable-input" class="ui-responsive table-stripe">
        <thead>
          <tr>
            <th>Time</th>
            <th>Message</th>
          </tr>
        </thead>
        <tbody>
          <!--tr>
            <td>12/12 12:01:17</td>
            <td>Web client request - queryBet:{....................}</td>
          </tr>
          <tr>
            <td>12/12 12:01:12</td>
            <td>Web client request - queryBet:{.................................}</td>
          </tr-->
        </tbody>
      </table>
    </div>
    <!-- /content -->
	<div data-role="popup" id="popupDialog" class="ui-content" data-overlay-theme="b" data-theme="b" data-dismissible="false" style="max-width:200px;">
      <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
	  <div style="text-align: center">
	    <h3></h3>
        <button id="start-btn" class="ui-btn ui-corner-all ui-shadow ui-btn-c ui-btn-inline" >Start</button>
	  </div>      
    </div>
	<!-- /popup -->
    <div data-role="footer" data-theme="c" data-position="fixed"> 
	  <div id="sys-msg">Ready</div>
	</div>
    <!-- /footer -->
	<div data-role="panel" id="left-panel" data-display="overlay" data-theme="none" >
      <ul data-role="listview">
	  	<li><plc>Routines</plc></li>
        <li><pl func="dailyRacecardRefresh">Refresh Racecard</pl></li>
        <li><pl func="step1">Step 1</pl></li> 
        <li><pl func="step1_1">Step 1_1</pl></li> 
        <li><pl func="step2">Step 2</pl></li> 
        <li><pl func="step3">Step 3</pl></li>
        <li><pl func="step4">Step 4</pl></li> 
        <li><pl func="step5">Step 5</pl></li> 
        <li><pl func="step6">Step 6</pl></li> 
        <li><pl func="step7">Step 7</pl></li> 
        <li><pl func="lastStepReleaseSpreadsheet">Final Release</pl></li>
      </ul>
    </div>
    <!-- /left-panel -->   
    <div data-role="panel" id="right-panel" data-display="push" data-position="right" data-theme="none">
      <ul data-role="listview"> 
        <li><h4>Clean Log</h4></li> 
        <li><h4>Post Race</h4>
          <ul data-role="listview">
            <li>Get All Results</li>
            <li>Insert Raw Data</li>
          </ul>
        </li> 
        <li><h4>Delete Triggers</h4></li> 
        <li><h4>Query Bet</h4></li>
		<li>Test Mode:
          <label for="test-mode-switch" class="ui-hidden-accessible">Test Mode:</label>
          <select name="test-mode" id="test-mode-switch" data-role="slider" data-mini="true" data-track-theme="b" data-theme="b">
            <option value="off">Off</option>
            <option selected value="on">On</option>
          </select>
		</li>
      </ul>
	  <!--form>
    	<div class="ui-field-contain" >
    	</div>
	  </form-->
    </div>
    <!-- /right-panel -->
  </div>
  <!-- /page -->
  <script>
  var lastFunc = ""; //global to hold last webapp func name invoked
  var reqFunc = "";  //global to hold webapp func being requested
  
    $( document ).on( "pageinit", "#main-page", function() {
        $( document ).on( "swipeleft swiperight", "#main-page", function( e ) {
            // We check if there is no open panel on the page because otherwise
            // a swipe to close the left panel would also open the right panel (and v.v.).
            // We do this by checking the data that the framework stores on the page element (panel: open).
            if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
                if ( e.type === "swipeleft"  ) {
                    $( "#right-panel" ).panel( "open" );
                } else if ( e.type === "swiperight" ) {
                    //$( "#left-panel" ).panel( "open" );
                }
            }
        });
    });
	
	$("#refresh-btn").on("click", function() {
		console.log("***routine-btn clicked!!!");
		$("#refresh-btn").attr("disabled","");
		callGoogleScript('getLastLogMsgs',25, getLastLogMsgsCompl);
	});
	
	$("#routine-btn").on("click", function() {
		console.log("***refresh-btn clicked!!!");
		$( "#left-panel" ).panel( "open" );
	});
	
	$("pl").on("click", function() {
		var funcLabel = this.innerHTML;
		reqFunc = this.getAttribute("func");  //save globally for reference in dialog
		console.log("pl tag value " + funcLabel + " for func " + reqFunc + " clicked!!!");
		$dialog = $( "#popupDialog" );
		var prompt = "Run " + funcLabel + "?"
		if ($("#start-btn")[0].hasAttribute("disabled")) //jq has no hasAttribute method
			prompt = "Waiting for " + lastFunc + "'s response!<br>" + prompt;
		$dialog.find("h3").html(prompt);
		$dialog.popup( "open" );
	});
	
	$("#start-btn").on("click", function() {
		console.log("***start-btn clicked!!!");
		$("#start-btn").attr("disabled","");
		$("#popupDialog").popup("close");
		$("#left-panel").panel("close");	
		lastFunc = reqFunc; //indicate lastFunc started
		callGoogleScript(lastFunc);
	});
  </script>
  <script src="webapps.js" async></script>
</body>

</html>